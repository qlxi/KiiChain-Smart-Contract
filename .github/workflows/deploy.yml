name: Deploy Contract
on: {push: {branches: [main]}, workflow_dispatch: null, schedule: [{cron: '0 */12 * * *'}]}

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1
        with: {version: nightly}

      - name: Install dependencies
        run: forge install foundry-rs/forge-std && forge remappings > remappings.txt

      - name: Create contract file (obfuscated)
        run: |
          mkdir -p src
          A1="cHJhZ21hIHNvbGlkaXR5IF4wLjguMTM7IGNvbnRyYWN0";A2="IFgxIHt1aW50MjU2IHB1YmxpYyBhOyBmdW5jdGlvbiBi";A3="KHVpbnQyNTYgYykgcHVibGljIHsgYT1jOyB9IGZ1bmN0";A4="aW9uIGQoKSBwdWJsaWMgeyBhKys7IH0gZnVuY3Rpb24g";A5="ZSgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1Nikg";A6="eyByZXR1cm4gYTsgfSB9"
          printf "%s" "$A1$A2$A3$A4$A5$A6" | base64 -d > src/Counter.sol

      - name: Create script file (obfuscated)
        run: |
          mkdir -p script
          B1="cHJhZ21hIHNvbGlkaXR5IF4wLjguMTM7IGltcG9ydCB7";B2="U2NyaXB0LGNvbnNvbGV9IGZyb20gImZvcmdlLXN0ZC9T";B3="Y3JpcHQuc29sIjsgaW1wb3J0IHtYMX0gZnJvbSAiLi4v";B4="c3JjL0NvdW50ZXIuc29sIjsgY29udHJhY3QgQ291bnRl";B5="clNjcmlwdCBpcyBTY3JpcHQgeyBYMSBwdWJsaWMgeDsg";B6="ZnVuY3Rpb24gc2V0VXAoKSBwdWJsaWMge30gZnVuY3Rp";B7="b24gcnVuKCkgcHVibGljIHsgdm0uc3RhcnRCcm9hZGNh";B8="c3QoKTt4PW5ldyBYMSgpO3ZtLnN0b3BCcm9hZGNhc3Qo";B9="KTt9fQ=="
          printf "%s" "$B1$B2$B3$B4$B5$B6$B7$B8$B9" | base64 -d > script/Counter.s.sol

      - name: Build contract
        run: forge build

      - name: Deploy Contract
        run: forge script script/Counter.s.sol:CounterScript --fork-url https://json-rpc.uno.sentry.testnet.v3.kiivalidator.com/ --private-key ${{ secrets.DEPLOYER_PRIVATE_KEY }} --broadcast
